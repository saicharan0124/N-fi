{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _ethers = require(\"ethers\");\n\nvar _AbstractWeb3Connector = _interopRequireDefault(require(\"./AbstractWeb3Connector\"));\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nclass MagicWeb3Connector extends _AbstractWeb3Connector.default {\n  constructor() {\n    super(...arguments);\n\n    _defineProperty(this, \"type\", 'MagicLink');\n\n    _defineProperty(this, \"deactivate\", async () => {\n      this.unsubscribeToEvents(this.provider);\n\n      if (this.magicUser) {\n        await this.magicUser.user.logout();\n      }\n\n      this.account = null;\n      this.chainId = null;\n      this.provider = null;\n    });\n  }\n\n  async activate() {\n    let {\n      email,\n      apiKey,\n      network,\n      newSession\n    } = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    let magic = null;\n    let ether = null;\n\n    if (!email) {\n      throw new Error('\"email\" not provided, please provide Email');\n    }\n\n    if (!apiKey) {\n      throw new Error('\"apiKey\" not provided, please provide Api Key');\n    }\n\n    if (!network) {\n      throw new Error('\"network\" not provided, please provide network');\n    }\n\n    let Magic;\n\n    try {\n      var _require;\n\n      Magic = (_require = require('magic-sdk')) === null || _require === void 0 ? void 0 : _require.Magic;\n    } catch (error) {// Do nothing. User might not need walletconnect\n    }\n\n    if (!Magic) {\n      var _window;\n\n      Magic = (_window = window) === null || _window === void 0 ? void 0 : _window.Magic;\n    }\n\n    if (!Magic) {\n      throw new Error('Cannot enable via MagicLink: dependency \"magic-sdk\" is missing');\n    }\n\n    try {\n      magic = new Magic(apiKey, {\n        network: network\n      });\n\n      if (newSession) {\n        var _magic;\n\n        if ((_magic = magic) !== null && _magic !== void 0 && _magic.user) {\n          try {\n            var _magic2, _magic2$user;\n\n            await ((_magic2 = magic) === null || _magic2 === void 0 ? void 0 : (_magic2$user = _magic2.user) === null || _magic2$user === void 0 ? void 0 : _magic2$user.logout());\n          } catch (error) {// Do nothing\n          }\n        }\n      }\n\n      ether = new _ethers.ethers.providers.Web3Provider(magic.rpcProvider);\n      await magic.auth.loginWithMagicLink({\n        email: email\n      });\n    } catch (err) {\n      throw new Error('Error during enable via MagicLink, please double check network and apikey');\n    }\n\n    const loggedIn = await magic.user.isLoggedIn();\n\n    if (loggedIn) {\n      const signer = ether.getSigner();\n      const {\n        chainId\n      } = await ether.getNetwork();\n      const address = (await signer.getAddress()).toLowerCase(); // Assign Constants\n\n      this.account = address;\n      this.provider = ether.provider;\n      this.chainId = `0x${chainId.toString(16)}`; // Assign magic user for deactivation\n\n      this.magicUser = magic;\n      this.subscribeToEvents(this.provider);\n      return {\n        provider: this.provider,\n        account: this.account,\n        chainId: this.chainId\n      };\n    }\n\n    throw new Error('Error during enable via MagicLink, login to magic failed');\n  }\n\n}\n\nexports.default = MagicWeb3Connector;","map":{"version":3,"sources":["S:/final hackathon/nfi3/node_modules/moralis/lib/node/Web3Connector/MagicWeb3Connector.js"],"names":["Object","defineProperty","exports","value","default","_ethers","require","_AbstractWeb3Connector","_interopRequireDefault","obj","__esModule","_defineProperty","key","enumerable","configurable","writable","MagicWeb3Connector","constructor","unsubscribeToEvents","provider","magicUser","user","logout","account","chainId","activate","email","apiKey","network","newSession","magic","ether","Error","Magic","_require","error","_window","window","_magic","_magic2","_magic2$user","ethers","providers","Web3Provider","rpcProvider","auth","loginWithMagicLink","err","loggedIn","isLoggedIn","signer","getSigner","getNetwork","address","getAddress","toLowerCase","toString","subscribeToEvents"],"mappings":"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","sourcesContent":["\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _ethers = require(\"ethers\");\n\nvar _AbstractWeb3Connector = _interopRequireDefault(require(\"./AbstractWeb3Connector\"));\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nclass MagicWeb3Connector extends _AbstractWeb3Connector.default {\n  constructor(...args) {\n    super(...args);\n\n    _defineProperty(this, \"type\", 'MagicLink');\n\n    _defineProperty(this, \"deactivate\", async () => {\n      this.unsubscribeToEvents(this.provider);\n\n      if (this.magicUser) {\n        await this.magicUser.user.logout();\n      }\n\n      this.account = null;\n      this.chainId = null;\n      this.provider = null;\n    });\n  }\n\n  async activate({\n    email,\n    apiKey,\n    network,\n    newSession\n  } = {}) {\n    let magic = null;\n    let ether = null;\n\n    if (!email) {\n      throw new Error('\"email\" not provided, please provide Email');\n    }\n\n    if (!apiKey) {\n      throw new Error('\"apiKey\" not provided, please provide Api Key');\n    }\n\n    if (!network) {\n      throw new Error('\"network\" not provided, please provide network');\n    }\n\n    let Magic;\n\n    try {\n      var _require;\n\n      Magic = (_require = require('magic-sdk')) === null || _require === void 0 ? void 0 : _require.Magic;\n    } catch (error) {// Do nothing. User might not need walletconnect\n    }\n\n    if (!Magic) {\n      var _window;\n\n      Magic = (_window = window) === null || _window === void 0 ? void 0 : _window.Magic;\n    }\n\n    if (!Magic) {\n      throw new Error('Cannot enable via MagicLink: dependency \"magic-sdk\" is missing');\n    }\n\n    try {\n      magic = new Magic(apiKey, {\n        network: network\n      });\n\n      if (newSession) {\n        var _magic;\n\n        if ((_magic = magic) !== null && _magic !== void 0 && _magic.user) {\n          try {\n            var _magic2, _magic2$user;\n\n            await ((_magic2 = magic) === null || _magic2 === void 0 ? void 0 : (_magic2$user = _magic2.user) === null || _magic2$user === void 0 ? void 0 : _magic2$user.logout());\n          } catch (error) {// Do nothing\n          }\n        }\n      }\n\n      ether = new _ethers.ethers.providers.Web3Provider(magic.rpcProvider);\n      await magic.auth.loginWithMagicLink({\n        email: email\n      });\n    } catch (err) {\n      throw new Error('Error during enable via MagicLink, please double check network and apikey');\n    }\n\n    const loggedIn = await magic.user.isLoggedIn();\n\n    if (loggedIn) {\n      const signer = ether.getSigner();\n      const {\n        chainId\n      } = await ether.getNetwork();\n      const address = (await signer.getAddress()).toLowerCase(); // Assign Constants\n\n      this.account = address;\n      this.provider = ether.provider;\n      this.chainId = `0x${chainId.toString(16)}`; // Assign magic user for deactivation\n\n      this.magicUser = magic;\n      this.subscribeToEvents(this.provider);\n      return {\n        provider: this.provider,\n        account: this.account,\n        chainId: this.chainId\n      };\n    }\n\n    throw new Error('Error during enable via MagicLink, login to magic failed');\n  }\n\n}\n\nexports.default = MagicWeb3Connector;"]},"metadata":{},"sourceType":"script"}